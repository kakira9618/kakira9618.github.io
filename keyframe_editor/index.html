<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Keyframe Editor v1.0.0</title>
  <meta name="description" content="音源の中の特定時点（キーフレーム）を簡単に作成・管理し、JSONでエクスポートできるアプリです。" />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://kakira9618.github.io/keyframe_editor/" />
  <meta property="og:title" content="Keyframe Editor v1.0.0" />
  <meta property="og:description" content="音源の中の特定時点（キーフレーム）を簡単に作成・管理し、JSONでエクスポートできるアプリです。" />
  <meta property="og:image" content="https://kakira9618.github.io/keyframe_editor/ogp.png" />

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="https://kakira9618.github.io/keyframe_editor/" />
  <meta property="twitter:title" content="Keyframe Editor v1.0.0" />
  <meta property="twitter:description" content="音源の中の特定時点（キーフレーム）を簡単に作成・管理し、JSONでエクスポートできるアプリです。" />
  <meta property="twitter:image" content="https://kakira9618.github.io/keyframe_editor/ogp.png" />

  <link rel="stylesheet" href="css/styles.css" />
  <link rel="icon" type="image/png" href="icon.png" />
</head>
<body>
  <header style="display:flex; flex-direction:column; gap:8px; padding-bottom:4px;">
    <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:12px; flex-wrap:wrap;">
      <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
        <h1 style="margin-right:6px;">Keyframe Editor v1.0.0</h1>
        <a href="https://x.com/kakira9618" target="_blank" rel="noopener" style="color:var(--muted); font-size:13px; text-decoration:none;">
          by @kakira9618
        </a>
      </div>
      <div class="muted" style="font-size:12px; text-align:right;">
        操作:
        <kbd style="font-family: ui-monospace, monospace; background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); padding:2px 6px; border-radius:6px;">Space</kbd>
        再生/停止、
        <kbd style="font-family: ui-monospace, monospace; background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); padding:2px 6px; border-radius:6px;">h</kbd>/<kbd style="font-family: ui-monospace, monospace; background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); padding:2px 6px; border-radius:6px;">l</kbd>
        コマ送り、
        <kbd style="font-family: ui-monospace, monospace; background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); padding:2px 6px; border-radius:6px;">K</kbd>
        キーフレーム追加、
        <kbd style="font-family: ui-monospace, monospace; background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); padding:2px 6px; border-radius:6px;">ホイール</kbd>
        水平スクロール、
        <kbd style="font-family: ui-monospace, monospace; background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); padding:2px 6px; border-radius:6px;">Ctrl/Cmd + ホイール</kbd>
        ズーム
      </div>
    </div>
    <div style="display:flex; align-items:flex-start; gap:10px; flex-wrap:wrap;">
      <div id="fileDrop" class="dropzone">
        <label style="display:block; margin-bottom:6px;">音源選択（mp3 / wav / ogg / flac / m4a）</label>
        <div style="display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
          <label for="file" class="file-btn">音声を選択</label>
          <input id="file" type="file" accept="audio/*" style="display:none;" />
          <span id="fileNameLabel" class="muted" style="font-size:12px;">ファイル未選択</span>
        </div>
      </div>
      <div class="dropzone about-dropzone" style="flex:1; min-width:300px;">
        <label class="about-label">このアプリについて: (<a href="https://github.com/kakira9618/kakira9618.github.io/tree/master/keyframe_editor" target="_blank" rel="noopener">GitHub</a>)</label>
        <ul class="about-list">
          <li>本アプリは、音源の中の特定時点（キーフレーム）を簡単に作成・管理し、JSONでエクスポートできるアプリです。</li>
          <li>本アプリは、無料でお使いいただけます。作成データも公序良俗の範囲内でご自由にご利用いただけます（商用利用も可能です）。</li>
          <li>音源や作成されたJSONデータはブラウザ内でのみ処理され、サーバーへ送信されることはありません。</li>
          <li>本アプリのご利用により生じた損害について、<a href="https://x.com/kakira9618">@kakira9618</a> は責任を負いかねます。</li>
        </ul>
      </div>
    </div>
  </header>

  <main>
    <section class="card">
      <div class="row" style="align-items:center; gap:12px; flex-wrap:wrap;">
        <div style="flex:1; min-width:120px;"></div>

        <div style="flex:0 0 auto; display:flex; flex-direction:column; align-items:center; gap:6px; width:200px;">
          <div id="timeDisplayWrap" class="time-digi-wrap">
            <div id="timeDisplay" class="time-digi">--:--.---</div>
          </div>
          <div class="row" style="gap:8px; flex-wrap:nowrap; white-space:nowrap; align-items:center; padding:6px 0 4px;">
            <button id="stepBack" class="ctrl-btn" disabled title="コマ送り戻す (h)" aria-label="コマ送り戻す" aria-keyshortcuts="h">⏮︎</button>
            <button id="play" class="ctrl-btn primary" disabled title="再生/停止 (Space)" aria-label="再生/停止" aria-keyshortcuts="Space">▶︎</button>
            <button id="stepFwd" class="ctrl-btn" disabled title="コマ送り進む (l)" aria-label="コマ送り進む" aria-keyshortcuts="l">⏭︎</button>
            <span style="height:26px; width:1px; background: rgba(255,255,255,0.18); margin:0 6px; display:inline-block;"></span>
            <button id="addKf" class="ctrl-btn primary" disabled title="キーフレーム追加 (K)" aria-label="キーフレーム追加" aria-keyshortcuts="k">✚</button>
          </div>
        </div>

        <div class="row" style="flex:1; justify-content:flex-end; align-items:center; gap:12px; min-width:260px;">
          <div class="zoom-control">
            <label>再生速度</label>
            <div class="zoom-slider-wrapper">
              <input id="rate" type="range" class="zoom-slider" min="0" max="200" step="1" value="100" disabled aria-label="再生速度" />
            </div>
            <div id="rateLabel" class="zoom-label">1x</div>
          </div>

          <div class="zoom-control">
            <label>波形ズーム</label>
            <div class="zoom-slider-wrapper">
              <input id="zoom" type="range" class="zoom-slider" min="0" max="200" step="1" value="100" disabled aria-label="波形ズーム" />
            </div>
            <div id="zoomLabel" class="zoom-label">1x</div>
          </div>
        </div>
      </div>

      <div class="wavewrap" style="margin-top:12px;">
        <div class="wavebox">
          <div class="muted">Overview</div>
          <div id="overview-container"></div>
        </div>
        <div class="wavebox">
          <div class="muted">Zoom view</div>
          <div id="zoomview-container"></div>
        </div>
        <div class="wavebox">
          <div class="row" style="justify-content:space-between; align-items:center;">
            <div class="muted">Spectrogram</div>
            <div class="row" style="gap:10px; align-items:center; flex-wrap:wrap;">
              <label class="row" style="gap:6px; font-size:12px; color:var(--muted);">
                <input id="enableSpectrogram" type="checkbox" checked />
                スペクトログラムを計算する
              </label>
              <label class="row" style="gap:6px; font-size:12px; color:var(--muted);">
                <input id="useWebGPU" type="checkbox" />
                WebGPUを使う
              </label>
            </div>
          </div>
          <div id="spectrum-container">
            <canvas id="spectrum-canvas"></canvas>
            <div id="spectrum-status" class="spec-status">ファイル未選択</div>
            <div id="spectrum-playhead" class="spec-playhead" aria-hidden="true"></div>
          </div>
        </div>
      </div>

      <audio id="audio" preload="auto" crossorigin="anonymous"></audio>
    </section>

    <div class="split-row">
      <section class="card">
        <div class="list">
          <div class="list-header">
            <div class="row" style="justify-content:space-between; align-items:center;">
              <div>
                <strong style="font-size:13px;">キーフレーム一覧</strong>
              </div>
              <div class="row" style="gap:8px; align-items:center;">
                <label class="muted" style="font-size:11px;">フィルタ</label>
                <select id="labelFilter" class="small" style="padding:6px 8px; font-size:12px; min-width:120px;">
                  <option value="">(すべて)</option>
                </select>
              </div>
            </div>
          </div>
          <div id="kfListContent" class="list-content">
            <div id="kfList"></div>
          </div>
          <div id="listResizer" class="list-resizer"></div>
        </div>
      </section>

      <aside class="card">
        <div class="row" style="justify-content:space-between;">
          <strong style="font-size:13px;">Keyframes JSON</strong>
          <button id="export" disabled>出力</button>
        </div>
        <textarea id="json" spellcheck="false" aria-label="キーフレームJSON"></textarea>
      </aside>
    </div>
  </main>

  <!-- Export Modal -->
  <div id="exportModal" class="modal" style="display:none;">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <strong style="font-size:14px;">キーフレーム出力</strong>
        <button id="closeModal" class="close-btn" aria-label="閉じる">✕</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="offsetInput">時間オフセット（秒）</label>
          <input id="offsetInput" type="number" step="0.001" value="0" placeholder="例: 1.5 / -2.0" />
          <div class="form-hint">すべてのキーフレームの時間に加減算されます</div>
        </div>
        <div class="form-group">
          <label>プレビュー</label>
          <textarea id="previewJson" spellcheck="false" readonly aria-label="プレビューJSON"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button id="copyFromModal" class="primary">クリップボードにコピー</button>
        <button id="downloadJson">ファイルとしてダウンロード</button>
      </div>
    </div>
  </div>

  <!-- Peaks.js standalone UMD -->
  <script src="https://unpkg.com/peaks.js/dist/peaks.js"></script>

  <!-- Main application -->
  <script type="module" src="js/main.js"></script>
</body>
</html>
